
# Enable C++ support
language: cpp

env:
  global:
    - NUM_THREADS=4

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc
      addons:
       apt:
         sources:
         - sourceline: 'ppa:bzindovic/suitesparse-bugfix-1319687'
         - sourceline: 'ppa:xqms/opencv-nonfree'
         - sourceline: 'ppa:ubuntu-toolchain-r/test'
         - sourceline: 'ppa:george-edison55/cmake-3.x'
         packages:
         - libtool 
         - pkg-config 
         - build-essential 
         - autoconf 
         - automake
         - gfortran
         - libgflags-dev
         - libgoogle-glog-dev
         - libgtest-dev
         - libboost-all-dev 
         - libeigen3-dev 
         - libopenblas-dev
         - libopencv-dev
         - libopencv-nonfree-dev
         - cmake
         - libgoogle-glog-dev
         - libatlas-base-dev
         - libeigen3-dev
         - libsuitesparse-dev
         - libtbb-dev

# dependency install steps
before_install:   
  - git clone https://ceres-solver.googlesource.com/ceres-solver -b master v1.12.0
  - cd ceres-solver
  - mkdir build
  - cd build
  - cmake ..
  - sudo make -j3 install
  - cd ../..
  - 
  - git clone https://github.com/schuhschuh/cmake-basis.git
  - cd cmake-basis
  - mkdir build
  - cd build
  - cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
  - sudo make -j install
  - cd ../..
  - 
  - git clone https://github.com/google/flatbuffers.git -b master v1.5.0
  - cd flatbuffers
  - mkdir build
  - cd build
  - cmake ..
  - sudo make -j install
  - cd ../..
  -
  - git clone https://github.com/hengli/camodocal.git
  - cd camodocal
  - mkdir build
  - cd build
  - cmake ..
  - sudo make -j install
  - cd ../..
  -
  - git clone https://github.com/gabime/spdlog.git -b master v0.11.0
  - cd spdlog
  - mkdir build
  - cd build
  - cmake ..
  - sudo make -j install
  - cd ../..
  -
  - mkdir -p ~/src
  - git clone https://github.com/ahundt/robotics_setup.git
  - cd robotics_setup
  - ./robotics_tasks.sh
  - cd ..
  -
  # ROS indigo setup
  - sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'
  - sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
  - sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
  - sudo apt-get update
  - sudo apt-get install ros-indigo-ros-base

# Build steps
script:
  - git clone https://github.com/ahundt/grl.git
  - cd grl
  - mkdir build
  - cd build
  - cmake ..
  - make
#  - sudo make install
#  - cd ../..
